<form class="task-form-container" [formGroup]="taskForm" (ngSubmit)="onSubmit()">

  <div class="form-header">
    <button mat-icon-button type="button" aria-label="Voltar" (click)="goBack()">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <h1>{{ isEditMode ? 'Editar Tarefa' : 'Nova Tarefa' }}</h1>
    <button mat-icon-button type="submit" [disabled]="taskForm.invalid" aria-label="Salvar tarefa">
      <mat-icon>check</mat-icon>
    </button>
  </div>

  <mat-form-field appearance="outline">
    <mat-label>Tag</mat-label>
    <mat-select formControlName="category">
      @for(cat of categories; track cat) {
        <mat-option [value]="cat">{{ cat }}</mat-option>
      }
    </mat-select>
  </mat-form-field>

  <mat-form-field appearance="outline">
    <mat-label>Tarefa</mat-label>
    <input matInput formControlName="name" placeholder="Ex: Estudar Angular Signals">
  </mat-form-field>

  <div class="priority-group">
    <label>Prioridade: {{ formatPriorityLabel(taskForm.get('priority')?.value) }}</label>
    <mat-slider min="1" max="3" step="1" discrete>
      <input matSliderThumb formControlName="priority">
    </mat-slider>
  </div>

  <mat-form-field appearance="outline">
    <mat-label>Término</mat-label>
    <input matInput [matDatepicker]="endDatePicker" formControlName="endDate" placeholder="Indefinido">
    <mat-datepicker-toggle matSuffix [for]="endDatePicker"></mat-datepicker-toggle>
    <mat-datepicker #endDatePicker></mat-datepicker>
  </mat-form-field>

  @if(showAdvanced()) {
    <mat-form-field appearance="outline">
      <mat-label>Observações (opcional)</mat-label>
      <textarea matInput formControlName="description"></textarea>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Início</mat-label>
      <input matInput [matDatepicker]="startDatePicker" formControlName="startDate">
      <mat-datepicker-toggle matSuffix [for]="startDatePicker"></mat-datepicker-toggle>
      <mat-datepicker #startDatePicker></mat-datepicker>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Lembrete</mat-label>
      <mat-select formControlName="reminder">
        @for(rem of reminders; track rem) {
          <mat-option [value]="rem">{{ rem }}</mat-option>
        }
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Frequência de repetição</mat-label>
      <mat-select formControlName="repetition">
        @for(rep of repetitions; track rep) {
          <mat-option [value]="rep">{{ rep }}</mat-option>
        }
      </mat-select>
    </mat-form-field>
  }

  @if(!isEditMode) {
    <mat-checkbox formControlName="keepAdding">Continuar adicionando tarefas.</mat-checkbox>

    <button class="advanced-toggle" type="button" (click)="showAdvanced.set(!showAdvanced())">
      {{ showAdvanced() ? 'Ver menos configurações' : 'Ver mais configurações' }}
      <mat-icon>{{ showAdvanced() ? 'expand_less' : 'expand_more' }}</mat-icon>
    </button>
  }
</form>
